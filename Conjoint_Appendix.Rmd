---
title: "Online Appendix for the Paper Issue Frustration, Ideology, and Populist Radical Right Vote in Europe"
author: "Nora Kirkizh and Sebastian Stier"
date: "01/04/2020"
output:
  pdf_document: default
  html_document: default
---

```{r, include=FALSE}

rm(list=ls())
library(tidyverse)
library(jtools)
library(rio)
library(cregg)
library(ggplot2)
library(gridExtra)
library(grid)
library(expss)
library(tidyr)
library(data.table)
requireNamespace("xtable", quietly = TRUE)
# load data
conjoint <- cj_df(rio::import("../Output/conjoint_plotting_data.RData"))
conjoint[, 2:16] <- NULL

```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, fig.width=13, fig.height=5, message=FALSE, warning=FALSE, error=FALSE)
```

## Introduction

This is an R Markdown report on preliminary analysis of conjoint survey experiment output. The conjoint survey experiment aimed to test hypotheses on populist radical right voters policy preferences. Voters were asked to evaluate eight pairs of profiles of candidates for a parliament seat in a corresponding country. Voters from France, italy, Spain, and Germany took part in the survey experiment or 1951 voters in total, whcih resulted in 31216 evaluated candidate rofiles. We are adopting the code from <https://github.com/leeper/conjoint-subgroups>. Plots by party identification, country of residence, and other political attitudes and sociodemographic background features can be found here.

```{r PRRV vs nonPRRV and most important issue}

surveys <- readRDS("../Data/paneldata.Rds") # survey data
load("../Output/conjoint_sample.Rda") # respondents with party ids from conjoint
df <- merge(surveys, conjoint_sample, by = "panelist_id") # merge with conjoint sample


# All countries Wave 1: PRRV vs non PRRV
df %>% filter(!is.na(issuesfirstW1) & issuesfirstW1 != "Don't know/no responce") %>%
  group_by(group, issuesfirstW1) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW1, y=perc*100, fill=ifelse(issuesfirstW1=="Immigration",      "Highlighted", "Normal"))) + 
  geom_bar(stat="identity", width = 0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3), legend.position="none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="Most important issue facing the country (Wave 1)", x="", y="Percent (%)") + 
  scale_fill_manual(values = c("red", "#666666"))


# without Germany
pooled_issueW1 <- df %>% filter(country.x != "Germany") %>%  filter(!is.na(issuesfirstW1) & issuesfirstW1 !=  "Don't know/no responce") %>%
  group_by(group, issuesfirstW1) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW1, y=perc*100, fill=ifelse(issuesfirstW1=="Immigration",      "Highlighted", "Normal"))) + 
  geom_bar(stat="identity", width=0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3), 
        legend.positio ="none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="Most important issue facing the country (without Germany)", 
       x="", y="Percent (%)") + 
  scale_fill_manual(values=c("red", "#666666"))


```


```{r Issuefirst Wave 2}

# All countries Wave 2: PRRV vs non PRRV
pooled_issueW2 <-  df %>% filter(!is.na(issuesfirstW2) & issuesfirstW2 != "Don't know/no responce") %>%
  group_by(group, issuesfirstW2) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW2, y=perc*100, fill=ifelse(issuesfirstW2=="9", "Highlighted", 
                                                      "Normal"))) + 
  geom_bar(stat="identity", width = 0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3), legend.position="none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="Most important issue facing the country (Wave2)", x="", y="Percent (%)") + 
  scale_fill_manual(values = c("red", "#666666"))

```


```{r Figure 1: PRRV vs nonPRRV and most important issue by COUNTRY}

# France: PRRV vs nonPRRV
fr_issue <- df %>% filter(country.x=="France") %>% filter(!is.na(issuesfirstW1) & issuesfirstW1 != "Don't know/no responce") %>%
  group_by(group, issuesfirstW1) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW1, y=perc*100, fill=ifelse(issuesfirstW1=="Immigration",     "Highlighted", "Normal"))) + 
  geom_bar(stat="identity", width=0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3), 
        legend.position="none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="France: Most important issue facing the country", x="", y="Percent (%)") + 
  scale_fill_manual(values=c("red", "#666666"))


# Italy: PRRV vs nonPRRV
it_issue <- df %>% filter(country.x=="Italy") %>% filter(!is.na(issuesfirstW1) & issuesfirstW1 != "Don't know/no responce") %>%
  group_by(group, issuesfirstW1) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW1, y=perc*100, fill=ifelse(issuesfirstW1=="Immigration",      "Highlighted", "Normal"))) + 
  geom_bar(stat="identity", width=0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3),
        legend.position="none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="Italy: Most important issue facing the country", x="", y="Percent (%)") + 
  scale_fill_manual(values=c("red", "#666666"))


# Germany: PRRV vs nonPRRV
ger_issue <- df %>% filter(country.x=="Germany") %>% filter(!is.na(issuesfirstW1) & issuesfirstW1 != "Don't know/no responce") %>%
  group_by(group, issuesfirstW1) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW1, y=perc*100, fill=ifelse(issuesfirstW1=="Immigration",      "Highlighted", "Normal"))) + 
  geom_bar(stat="identity", width=0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3), 
        legend.position = "none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="Germany: Most important issue facing the country", x="", y="Percent (%)") + 
  scale_fill_manual(values = c("red", "#666666"))


# Spain: PRRV vs nonPRRV
spain_issue <- df %>% filter(country.x=="Spain") %>% filter(!is.na(issuesfirstW1) & issuesfirstW1 != "Don't know/no responce") %>%
  group_by(group, issuesfirstW1) %>% 
  summarise(count=n()) %>%
  mutate(perc=count/sum(count)) %>% 
  ggplot(aes(x=issuesfirstW1, y=perc*100, fill=ifelse(issuesfirstW1=="Immigration",          "Highlighted", "Normal"))) + 
  geom_bar(stat="identity", width=0.7) +
  theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.3), legend.position="none") +
  facet_wrap(~group, scales="free_x") +
  labs(title="Spain: Most important issue facing the country", x="", y="Percent (%)") + 
  scale_fill_manual(values=c("red", "#666666"))


grid.draw(rbind(ggplotGrob(pooled_issueW1), size = "last"))

library(ggpubr)
ggarrange(pooled_issueW1, # First row with line plot
  # Second row with box and dot plots
  ggarrange(fr_issue, it_issue, ger_issue, spain_issue, ncol = 4, 
            labels = c("B", "C", "D", "E")), 
            nrow = 2, labels = "A") # Label of the line plot


ggarrange(pooled_issueW1, fr_issue+rremove("x.text"), it_issue+rremove("x.text"), ger_issue+rremove("x.text"), spain_issue+rremove("x.text"), labels = c("A", "B", "C", "D", "E"), ncol = 3, nrow = 3)

# +rremove("x.text")

```

# Most important issue and ideology

```{r Immigration, Climate, Living costs, EU, Populism,}

# combining left-right variable for Germany from Wave 0 with Wave 1
df$leftrightW0[is.na(df$leftrightW0)] = 0
df$leftrightW1[is.na(df$leftrightW1)] = 0
df$lf <- df$leftrightW1 + df$leftrightW0

df$lr <- car::recode(df$lf, "1=0; 2=1; 3=2; 4=3; 5=4; 6=5; 7=6; 8=7; 9=8; 10=9; 11=10; else=NA")

df$imm_index <- (df$immprobs_socialsystemW1 + df$immprobs_jobsW1 + df$immprobs_crimeW1)/3
df$imm_rec <- car::recode(df$imm_index, "0:2.33333333333333='0'; else='1'")
df$climate_tax01 <- car::recode(df$climatepolicies_taxesW2, "0:2=1; 4:5=0; else=NA")
df$livcosts01 <- car::recode(df$leftpopattid_govredW2, "0:2=1; 4:5=0; else=NA")
df$euintegr01 <- car::recode(df$euintegrationW1, "0:4=1; 6:10=0; else=NA")
df$climate_renew01 <- car::recode(df$climatepolicies_renewableW2, "0:2=1; 4:5=0; else=NA")


# Immigration
Imm <- ggplot(data=df, aes(x=lr,y=imm_rec)) + 
  geom_hline(yintercept=0.5,color="red") + 
  stat_smooth(fill="black",color="black",size=0.6,method="loess") +
  scale_x_continuous(breaks=0:10) + 
  scale_y_continuous(breaks = c(0.00,0.25,0.50,0.75,1.00)) +
  ylab("Opposed to Immigration") + 
  xlab("") +
  coord_cartesian(xlim =c(0, 10), ylim = c(0, 1)) +
  theme_bw() +
  theme(axis.text = element_text(size = 8), axis.title = element_text(size=8),
        title=element_text(size=10))


# Climate
Clima <- ggplot(data=df, aes(x=lr,y=climate_renew01)) +
  geom_hline(yintercept=0.5,color="red") +
  stat_smooth(fill="black",color="black",size=0.6,method="loess") +
  scale_x_continuous(breaks=0:10) +
  scale_y_continuous(breaks = c(0.00,0.25,0.50,0.75,1.00)) +
  ylab("Opposed to Subsidise for Renewables") +
  xlab("") +
  coord_cartesian(xlim =c(0, 10), ylim = c(0, 1)) +
  theme_bw() +
  theme(axis.text = element_text(size = 8), axis.title = element_text(size=8),
        title=element_text(size=10))


# Living costs
Livcosts <- ggplot(df, aes(x=lr,y=livcosts01)) +
  geom_hline(yintercept=0.5,color="red") +
  stat_smooth(fill="black",color="black",size=0.6,method="loess") +
  scale_x_continuous(breaks=0:10) +
  scale_y_continuous(breaks = c(0.00,0.25,0.50,0.75,1.00)) +
  ylab("Opposed to Redistribution") +
  xlab("") +
  coord_cartesian(xlim =c(0, 10), ylim = c(0, 1)) +
  theme_bw() +
  theme(axis.text = element_text(size = 8), axis.title = element_text(size=8),
        title=element_text(size=10))


# EU integration
EUinter <- ggplot(df, aes(x=lr,y=euintegr01)) +
  geom_hline(yintercept=0.5,color="red") +
  stat_smooth(fill="black",color="black",size=0.6,method="loess") +
  scale_x_continuous(breaks=0:10) +
  scale_y_continuous(breaks = c(0.00,0.25,0.50,0.75,1.00)) +
  ylab("Opposed to EU Integration") +
  xlab("\nIdeology: 0 (Left) to 10 (Right)") +
  coord_cartesian(xlim =c(0, 10), ylim = c(0, 1)) +
  theme_bw() +
  theme(axis.text = element_text(size = 8), axis.title = element_text(size=8),
        title=element_text(size=10))


gridExtra::grid.arrange(Imm, Clima, Livcosts, EUinter, ncol=2, nrow=2)

grid.draw(rbind(ggplotGrob(Imm), ggplotGrob(Clima), ggplotGrob(Livcosts), ggplotGrob(EUinter), size = "last"))


```

# Most important issue based on conjoint experiment

```{r Plot to show that immigration has the largest effects on Pr(Choosing a candidate)}

PRRV <- conjoint[conjoint$group == "PRRV",]
nonPRRV <- conjoint[conjoint$group == "nonPRVV",]

result <- cregg::cj(
    PRRV, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm")


nonprrv <- cregg::cj(
    nonPRRV, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm")


result_df <- data.frame(result)
result_df$Voters <- rep("PRRV")
nonprrv_df <- data.frame(nonprrv)
nonprrv_df$Voters <- rep("nonPRRV")
combined <- rbind(result_df, nonprrv_df)


ggplot(combined, aes(estimate, level, colour=Voters)) +
  geom_point() + 
  geom_errorbarh(data = combined, mapping=aes(y=level, xmax=lower, xmin=upper), 
                 height=0, size=0.5) + 
  geom_text(aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)), size = 1.5, 
            position = position_nudge(y = 0.4)) +
  scale_x_continuous(limits=c(0.25, 0.75)) +
  facet_wrap(~feature, scales="free_y", ncol=1) +
  geom_vline(xintercept = 0.5, linetype="solid", color = "black", size=0.2) +
  annotate("rect", xmin = 0.4, xmax = 0.6, ymin = -Inf, ymax = Inf, 
           fill = "black", alpha = 0.2, color = NA) +
  ggtitle("") +
  theme_bw() + 
  ylab("") + 
  xlab("Pr(Choosing a candidate)") +
  theme(axis.text=element_text(size=8), axis.title=element_text(size=8),
        title=element_text(size=10)) +
  scale_color_manual(values = c("#999999", "#000000"))


```


```{r, }




```


# Testing Pre-registered Hypothesis about The Limist of Issue Frustration

```{r, Subsetting profiles with PRR position on immigration}

conjoint$task <- rep(1:8, each=2) # add task number variable
conjoint$num_imm <- as.numeric(conjoint$imm) # numerical imm
# only tasks with PRR imm position:
dtimm <- conjoint %>% group_by(panelist_id, task) %>% filter(1 %in% num_imm)

# but we don't need tasks, where both profiles proposed PRR imm measure, so let's remove them:
dtimm <- dtimm %>% group_by(panelist_id, task) %>% filter(sum(num_imm) > 2)

# drop tasks, where a panelist had to choose between profile with PRR and Left imm position, because Left imm position is as strong trigger too (see plots from the preliminary analysis)
dtimm <- dtimm %>% group_by(panelist_id, task) %>% filter(sum(num_imm) < 4)

# make other attributes numerial for further subsetting
dtimm$num_soc <- as.numeric(dtimm$soc)
dtimm$num_climate <- as.numeric(dtimm$climate)
dtimm$num_eu <- as.numeric(dtimm$eu)
dtimm$num_run <- as.numeric(dtimm$run)
dtimm <- as.data.frame(dtimm) # make sure it's df for further manipulations

```

```{r, Subsetting by number of left porposals in profiles: THREE}

#### Left positions: THREE #### 

dtimm_left3 <- dtimm %>%
  mutate(ind = rowSums(select(., 18:21) == 3) == 3) %>% 
  group_by(panelist_id, task) %>% 
  filter(if(any(ind)) all(ind[num_imm==1]) else FALSE) %>%
  ungroup %>%
  select(-ind)

dtimm_left3 <- dtimm_left3[dtimm_left3$group == "PRRV",] # only PRR voters

# length(unique(dtimm_left3$panelist_id))

# Plots
# Tasks: restricted Immigration + Three Left Positions (but competing candidate CAN propose open immigration)

left3a_plot <- plot(
  cregg::cj(
    dtimm_left3, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("ONE")

# Tasks: restricted Immigration + Three Left Positions (but competing candidate CANNOT propose open immigration)

left3b_plot <- plot(
  cregg::cj(
    dtimm_left3, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("THREE and no Left imm")

# gridExtra::grid.arrange(left3a_plot, left3b_plot, ncol=2)

```

```{r, TWO }
####  Left positions: TWO #### 

dtimm_left2 <- dtimm %>%
  mutate(ind = rowSums(select(., 18:21)==3)==2) %>% 
  group_by(panelist_id, task) %>% 
  filter(if(any(ind)) all(ind[num_imm==1]) else FALSE) %>% 
  ungroup %>% 
  select(-ind)

dtimm_left2 <- dtimm_left2[dtimm_left2$group == "PRRV",] # only PRR voters

# Tasks: restricted Immigration + Two Left Positions (but competing candidate CAN propose open immigration)

left2a_plot <- plot(
  cregg::cj(
    dtimm_left2, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("TWO")

# Tasks: restricted Immigration + Two Left Positions (but competing candidate CANNOT propose open immigration)

left2b_plot <- plot(
  cregg::cj(
    dtimm_left2, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("TWO left, and no Left imm")

```

```{r, ONE }
####  Left positions: ONE #### 

dtimm_left1 <- dtimm %>%
  mutate(ind = rowSums(select(., 18:21)==3)==1) %>% 
  group_by(panelist_id, task) %>% 
  filter(if(any(ind)) all(ind[num_imm==1]) else FALSE) %>% 
  ungroup %>% 
  select(-ind)

dtimm_left1 <- dtimm_left1[dtimm_left1$group == "PRRV",] # only PRR voters

# Tasks: restricted Immigration + Two Left Positions (but competing candidate CAN propose open immigration)

left1a_plot <- plot(
  cregg::cj(
    dtimm_left1, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("ONE")

# Tasks: restricted Immigration + Two Left Positions (but competing candidate CANNOT propose open immigration)

left1b_plot <- plot(
  cregg::cj(
    dtimm_left1, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("ONE and no left imm")

```

```{r, ZERO}

####  Left positions: ZERO #### 

dtimm_left0 <- dtimm %>%
  mutate(ind = rowSums(select(., 18:21)==3)==0) %>% 
  group_by(panelist_id, task) %>% 
  filter(if(any(ind)) all(ind[num_imm==1]) else FALSE) %>% 
  ungroup %>% 
  select(-ind)

dtimm_left0 <- dtimm_left0[dtimm_left0$group == "PRRV",] # only PRR voters

# Tasks: restricted Immigration + Two Left Positions (but competing candidate CAN propose open immigration)

left0a_plot <- plot(
  cregg::cj(
    dtimm_left0, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("ZERO")

# Tasks: restricted Immigration + Two Left Positions (but competing candidate CANNOT propose open immigration)

left0b_plot <- plot(
  cregg::cj(
    dtimm_left0, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("ZERO and no imm")

```

```{r, FOUR }

# With FOUR left positions we are underpowered

dtimm_left4 <- dtimm %>%
  mutate(ind = rowSums(select(., 18:21) == 3) == 4) %>% 
  group_by(panelist_id, task) %>% 
  filter(if(any(ind)) all(ind[num_imm==1]) else FALSE) %>%
  ungroup %>%
  select(-ind)

dtimm_left4 <- dtimm_left4[dtimm_left4$group == "PRRV",] # only PRR voters

left4b_plot  <- plot(
  cregg::cj(
    dtimm_left4, 
    selected ~ imm + soc + climate + eu + run,
    id = ~ panelist_id,
    estimate = "mm"
  ), vline = 0.5
) + 
  ggplot2::scale_x_continuous(
    limits = c(0.1, 0.9), 
    breaks = c(0.1, 0.2, 0.2, 0.3, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
  ) + 
  ggplot2::geom_text(
    aes(label = sprintf("%0.2f (%0.2f)", estimate, std.error)),
    colour = "black", 
    size = 2,
    position = position_nudge(y = .5)
  ) + 
  theme(legend.position="none") + ggtitle("FOUR and no imm")

```

# Numerical results

```{r, numerical results}
print(xtable::xtable(
  cj(dtimm_left3, 
     selected ~ imm + soc + climate + eu + run,
     id = ~ panelist_id,
     estimate = "mm",
     h0 = 0.5)[c("feature", "level", "estimate", "std.error", "z")],
     digits = 2, align = c("l", "l", "p{3in}", "r", "r", "r")), include.rownames = FALSE,
     comment=FALSE, size = "footnotesize")

```

## Plotting coefficients of interest

```{r, major plot in the paper}

m <- selected ~ imm + soc + climate + eu + run
m4 <- cj(dtimm_left4, m, id= ~ panelist_id, estimate="mm", h0=0.5)
m3 <- cj(dtimm_left3, m, id= ~ panelist_id, estimate="mm", h0=0.5)
m2 <- cj(dtimm_left2, m, id= ~ panelist_id, estimate="mm", h0=0.5)
m1 <- cj(dtimm_left1, m, id= ~ panelist_id, estimate="mm", h0=0.5)
m0 <- cj(dtimm_left0, m, id= ~ panelist_id, estimate="mm", ho=0.5)


imm_coefdt <- data.frame(n_left=c("0", "1", "2", "3", "4"), rbind(m0[1,], m1[1,], m2[1,], m3[1,], m4[1,]))


ggplot() + 
  geom_errorbarh(data = imm_coefdt, mapping=aes(y=n_left, xmax=lower, xmin=upper),   height=0.2, size=0.5, color="black") + 
  geom_point(data=imm_coefdt, mapping=aes(y=n_left, x=estimate), size=2, shape=21, 
             fill="black") + theme_bw() + 
  ylab("Number of left proposals in anti-immigrant candidate profile") + 
  xlab("Pr(Choosing anti-immigrant candidate)") +
  ggtitle("Competing candidate cannot propose pro-immigrant policy") + geom_vline(xintercept = 0.5, linetype="dashed", 
                color = "black", size=0.5) + 
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), title=element_text(size=10)) + 
  coord_flip()

##

imm3_coefdt <- data.frame(n_left=c("0", "1", "2", "3"), rbind(m0[1,], m1[1,], m2[1,], m3[1,]))

ggplot() + 
  geom_errorbarh(data = imm3_coefdt, mapping=aes(y=n_left, xmax=lower, xmin=upper), 
                 height=0.2, size=0.5, color="black") + 
  geom_point(data=imm3_coefdt, mapping=aes(y=n_left, x=estimate), size=2, shape=21, 
             fill="black") + 
  scale_x_continuous(limits=c(0.48, 0.9)) +
  theme_bw() + 
  ylab("Number of left proposals in anti-immigrant candidate profile") + 
  xlab("Pr(Choosing anti-immigrant candidate)") +
  ggtitle("Competing candidate cannot propose pro-immigrant policy") +
  geom_vline(xintercept = 0.5, linetype="dashed", 
                color = "black", size=0.5) + 
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10),
        title=element_text(size=10)) + coord_flip()


```
